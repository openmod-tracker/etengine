!!! 5
%html{:lang => 'en'}
  %head
    %title EnergyTransitionModel
    = javascript_include_tag 'application'
    - if current_user
      = javascript_include_tag '/inspect/search.js'

    = stylesheet_link_tag 'application'

  %body#data
    .navbar.navbar-inverse
      .navbar-inner
        .container
          - if content_for?(:navbar)
            = content_for :navbar
          - else
            %a.brand{:href => etsource_root_path}
              ETEngine
              - if Rails.env.production?
                %span.server.production Production
              - elsif Rails.env.staging?
                %span.server.beta Beta
              - else
                %span.server.local Local

            - if current_user
              %ul.nav
                %li= link_to 'ETsource',  etsource_commits_path

                %li.dropdown
                  %a.dropdown-toggle{:href => '#', 'data-toggle' => 'dropdown'}
                    Data
                    %b.caret
                  %ul.dropdown-menu
                    %li= link_to 'Overview',       inspect_root_path
                    %li= link_to 'Area',           inspect_area_path
                    %li= link_to "Checks",         {:controller => 'inspect/checks', :action => 'expected_demand'}.merge
                    %li= link_to 'Carriers',       inspect_carriers_path
                    %li= link_to 'Converters',     inspect_converters_path
                    %li= link_to "Inputs",         inspect_inputs_path
                    %li= link_to "Scenarios",      inspect_scenarios_path
                    %li.divider
                    %li= link_to "Current Scenario".html_safe,      inspect_scenario_path(id: @api_scenario.id)
                %li.dropdown
                  %a.dropdown-toggle{:href => '#', 'data-toggle' => 'dropdown'}
                    Debug / GQL
                    %b.caret
                  %ul.dropdown-menu
                    %li= link_to 'GQL Sandbox',       test_inspect_gqueries_path
                    %li= link_to "GQL Search", inspect_gql_search_path
                    %li= link_to "GQL Log", inspect_gql_log_path
                    %li= link_to "GQL Warnings", inspect_gql_warnings_path
                    %li.divider
                    %li= link_to 'GQueries',  inspect_gqueries_path
                    %li.divider
                    %li= link_to 'Debug ActiveDocument',     inspect_debug_gql_path
                    %li= link_to 'Audit',     inspect_debug_calculation_path
                    %li= link_to 'Query Tables', inspect_query_tables_path
                %li.dropdown
                  %a.dropdown-toggle{:href => '#', 'data-toggle' => 'dropdown'}
                    Misc
                    %b.caret
                  %ul.dropdown-menu
                    %li= link_to 'Users',     users_path
                    %li= link_to 'Turk',      mechanical_turk_root_path

              %ul.nav.pull-right
                %li
                  %form.form-inline.navbar-search{:action => inspect_search_path, :method => :get}
                    %input.search-query.typeahead{:name => 'search', :placeholder => "Search", :autocomplete => 'off'}

                - if params[:api_scenario_id]
                  %li.divider-vertical
                  %li
                    %form#api_scenario_selector.navbar-form.form.form-inline{:action => inspect_redirect_path, :method => :get}
                      - opts = Scenario.recent.map{ |as| [as.identifier, as.id] }
                      = select_tag :api_scenario_id, options_for_select(opts, params[:api_scenario_id]), :class => 'span2'
                  %li
                    %form#area_code_selector.navbar-form.form.form-inline{:action => '#', :method => :get}
                      - opts = Etsource::Dataset.region_codes.sort
                      = select_tag 'area_code', options_for_select(opts), :prompt => "New scenario:", :class => 'span1'

                %li.divider-vertical
                %li
                  = link_to "Logout", destroy_user_session_path, :class => 'pull-right', :title => "Logged in as #{current_user.email}", :rel => 'tooltip', 'data-placement' => 'bottom', :method => :delete
            - else
              %ul.nav
                %li= link_to 'login', new_user_session_path


    .subnav.subnav-fixed= yield :subnav

    .container-fluid
      - if flash.any?
        #flash
          - flash.each do |type, msg|
            .alert{:class => type}
              %a.close x
              %p= msg

      #content= yield
      #footer
        = yield :footer
    - unless APP_CONFIG[:standalone]
      = render "layouts/ga" if Rails.env.production?

:javascript
  $('[rel=tooltip]').tooltip();
  $('.typeahead').typeahead({
    source: search_keys,
    items: 15,
    matcher: function(item) { return item.match(new RegExp(this.query.replace(/_/g, '._').replace(/\./g, '.*'))) != null }
  }).change( function() { this.form.submit(); });


